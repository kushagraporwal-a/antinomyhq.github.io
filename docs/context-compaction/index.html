<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-context-compaction" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Context Compaction | Forge Code</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://antinomyhq.github.io/tc-og-2.png"><meta data-rh="true" name="twitter:image" content="https://antinomyhq.github.io/tc-og-2.png"><meta data-rh="true" property="og:url" content="https://antinomyhq.github.io/docs/context-compaction/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Context Compaction | Forge Code"><meta data-rh="true" name="description" content="Optimize AI conversations with automatic context management"><meta data-rh="true" property="og:description" content="Optimize AI conversations with automatic context management"><link data-rh="true" rel="icon" href="/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://antinomyhq.github.io/docs/context-compaction/"><link data-rh="true" rel="alternate" href="https://antinomyhq.github.io/docs/context-compaction/" hreflang="en"><link data-rh="true" rel="alternate" href="https://antinomyhq.github.io/docs/context-compaction/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://748OFOGLOE-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Forge Code" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Forge Code RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Forge Code Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Forge Code JSON Feed">



<script defer="defer" data-domain="forgecode.dev" src="https://plausible.io/js/script.file-downloads.hash.outbound-links.pageview-props.revenue.tagged-events.js"></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script>
<script type="application/ld+json">{"@context":"https://schema.org/","@type":"WebSite","name":"ForgeCode","url":"https://forgecode.dev/"}</script>
<script>!function(e,n,t,i,c,s){e.SnitchObject=t,e[t]||(e[t]=function(){(e[t].q=e[t].q||[]).push(arguments)}),e[t].l=+new Date,c=n.createElement(i),s=n.getElementsByTagName(i)[0],c.src="//snid.snitcher.com/8432087.js",s.parentNode.insertBefore(c,s)}(window,document,"snid","script"),snid("verify","8432087")</script><link rel="stylesheet" href="/assets/css/styles.9a4339c1.css">
<script src="/assets/js/runtime~main.bcfb4473.js" defer="defer"></script>
<script src="/assets/js/main.e9fc866c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" aria-label="Forge Code" href="/"><div class="navbar__logo"><div style="height:24px;width:1px"></div></div><b class="navbar__title text--truncate" style="font-size:1.5rem;font-weight:700;letter-spacing:-0.02em">Forge Code</b></a><a class="navbar__item navbar__link" href="/">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog/">Blogs</a><a class="navbar__item navbar__link" href="/releases/">Releases</a></div><div class="navbar__items navbar__items--right"><div class="hidden lg:flex search-icon-navbar navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_eExm"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><div class="sidebar-search-container place-items-center flex flex-col lg:mb-[100px]"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="ForgeCode" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="ForgeCode" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation/">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/using-forge/">Using Forge</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/commands/">Basic Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/commands/">Built-in Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/operation-modes/">Operation Modes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/custom-rules/">Custom Rules</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/tools-reference/">Tools &amp; Resources</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools-reference/">Tools Reference</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/environment-configuration/">Advanced Configuration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/environment-configuration/">Environment Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/agent-configuration/">Agent Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/context-compaction/">Context Compaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/custom-commands/">Custom Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/custom-workflows/">Custom Workflows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security-features/">Security Features</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/error-handling/">Troubleshooting &amp; Maintenance</a></div></li></ul></nav></div></div></aside></div><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Advanced Configuration</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Context Compaction</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Context Compaction</h1></header>
<p>Forge includes powerful automatic context management capabilities that optimize AI conversations while preserving important information.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-is-context-compaction">What is Context Compaction?<a href="#what-is-context-compaction" class="hash-link" aria-label="Direct link to What is Context Compaction?" title="Direct link to What is Context Compaction?">​</a></h2>
<p>As conversations with AI agents grow longer, they can exceed token limits and become inefficient. Context compaction automatically summarizes older parts of conversations when they reach configurable thresholds, allowing you to maintain longer, more productive interactions without hitting model context limits.</p>
<p>Key benefits include:</p>
<ul>
<li><strong>Extended Conversations</strong>: Continue conversations beyond normal token limits</li>
<li><strong>Optimized Performance</strong>: Reduce token usage and improve response times</li>
<li><strong>Preserved Context</strong>: Keep critical information while summarizing less important details</li>
<li><strong>Cost Efficiency</strong>: Reduce token usage in API calls</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-it-works">How It Works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How It Works" title="Direct link to How It Works">​</a></h2>
<p>When a conversation reaches the configured token threshold:</p>
<ol>
<li>The system identifies which messages to preserve (based on the retention window)</li>
<li>Older messages are sent to the configured summarization model</li>
<li>A concise summary replaces the older messages</li>
<li>New conversation turns continue with the summarized context</li>
</ol>
<p>This process happens automatically and transparently to the user.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="configuration-options">Configuration Options<a href="#configuration-options" class="hash-link" aria-label="Direct link to Configuration Options" title="Direct link to Configuration Options">​</a></h2>
<p>Add the following to your <code>forge.yaml</code> file under an agent configuration:</p>
<div class="rounded-3xl overflow-hidden"><div class="bg-[#35353A] p-4 flex justify-between items-center"><span class="text-white text-xs font-space-mono"></span><div class="relative"><button aria-label="Copy code" class="flex flex-row items-center bg-transparent appearance-none border-none"><img src="/icons/basic/copy-icon.svg" alt="Copy Icon" class="w-4 h-4 cursor-pointer hover:opacity-80 transition-opacity duration-150"></button></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#303037"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#303037"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token key atrule" style="color:#b76b01">agents</span><span class="token punctuation" style="color:#fff">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token punctuation" style="color:#fff">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#b76b01">id</span><span class="token punctuation" style="color:#fff">:</span><span class="token plain"> assistant</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token key atrule" style="color:#b76b01">model</span><span class="token punctuation" style="color:#fff">:</span><span class="token plain"> anthropic/claude</span><span class="token punctuation" style="color:#fff">-</span><span class="token plain">3.5</span><span class="token punctuation" style="color:#fff">-</span><span class="token plain">sonnet</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token key atrule" style="color:#b76b01">compact</span><span class="token punctuation" style="color:#fff">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">      </span><span class="token key atrule" style="color:#b76b01">max_tokens</span><span class="token punctuation" style="color:#fff">:</span><span class="token plain"> </span><span class="token number" style="color:#C586C0">2000</span><span class="token plain"> </span><span class="token comment" style="color:#30C26D;font-style:italic"># Maximum tokens for the summary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">      </span><span class="token key atrule" style="color:#b76b01">token_threshold</span><span class="token punctuation" style="color:#fff">:</span><span class="token plain"> </span><span class="token number" style="color:#C586C0">80000</span><span class="token plain"> </span><span class="token comment" style="color:#30C26D;font-style:italic"># When to trigger compaction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">      </span><span class="token key atrule" style="color:#b76b01">model</span><span class="token punctuation" style="color:#fff">:</span><span class="token plain"> google/gemini</span><span class="token punctuation" style="color:#fff">-</span><span class="token plain">2.0</span><span class="token punctuation" style="color:#fff">-</span><span class="token plain">flash</span><span class="token punctuation" style="color:#fff">-</span><span class="token number" style="color:#C586C0">001</span><span class="token plain"> </span><span class="token comment" style="color:#30C26D;font-style:italic"># Model to use for summarization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">      </span><span class="token key atrule" style="color:#b76b01">retention_window</span><span class="token punctuation" style="color:#fff">:</span><span class="token plain"> </span><span class="token number" style="color:#C586C0">6</span><span class="token plain"> </span><span class="token comment" style="color:#30C26D;font-style:italic"># Recent messages to preserve</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">      </span><span class="token key atrule" style="color:#b76b01">prompt</span><span class="token punctuation" style="color:#fff">:</span><span class="token plain"> </span><span class="token string" style="color:#FDB869">&quot;{{&gt; system-prompt-context-summarizer.hbs }}&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#30C26D;font-style:italic"># Optional custom prompt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="configuration-parameters">Configuration Parameters<a href="#configuration-parameters" class="hash-link" aria-label="Direct link to Configuration Parameters" title="Direct link to Configuration Parameters">​</a></h3>
<table><thead><tr><th>Parameter</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>max_tokens</code></td><td>Yes</td><td>Maximum token count for the generated summary</td></tr><tr><td><code>token_threshold</code></td><td>Yes</td><td>Conversation token count that triggers compaction</td></tr><tr><td><code>model</code></td><td>Yes</td><td>AI model to use for generating the summary</td></tr><tr><td><code>retention_window</code></td><td>No</td><td>Number of recent messages to preserve unchanged</td></tr><tr><td><code>prompt</code></td><td>No</td><td>Custom prompt template for summarization</td></tr></tbody></table>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="selecting-appropriate-thresholds">Selecting Appropriate Thresholds<a href="#selecting-appropriate-thresholds" class="hash-link" aria-label="Direct link to Selecting Appropriate Thresholds" title="Direct link to Selecting Appropriate Thresholds">​</a></h3>
<p>Set <code>token_threshold</code> based on your model&#x27;s context window size. For example:</p>
<ul>
<li>For Claude 3.7 Sonnet (~200K token window): 150,000 to 180,000 tokens</li>
<li>For Claude 3.5 haiku (~200K token window): 120,000 to 160,000 tokens</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="choosing-summarization-models">Choosing Summarization Models<a href="#choosing-summarization-models" class="hash-link" aria-label="Direct link to Choosing Summarization Models" title="Direct link to Choosing Summarization Models">​</a></h3>
<p>For the summarization model, balance speed and quality:</p>
<ul>
<li>Fast models (like Gemini Flash) provide quicker summaries</li>
<li>More powerful models may provide better context preservation but take longer</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="retention-window-considerations">Retention Window Considerations<a href="#retention-window-considerations" class="hash-link" aria-label="Direct link to Retention Window Considerations" title="Direct link to Retention Window Considerations">​</a></h3>
<p>The retention window controls how many recent messages are preserved verbatim:</p>
<ul>
<li>Larger windows maintain more recent context but reduce compaction efficiency</li>
<li>Smaller windows allow for more aggressive compaction but may lose recent details</li>
<li>A typical value is 6-10 messages</li>
</ul>
<p>The template receives the conversation history and should instruct the model on how to create an effective summary.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="example-use-cases">Example Use Cases<a href="#example-use-cases" class="hash-link" aria-label="Direct link to Example Use Cases" title="Direct link to Example Use Cases">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="long-debugging-sessions">Long Debugging Sessions<a href="#long-debugging-sessions" class="hash-link" aria-label="Direct link to Long Debugging Sessions" title="Direct link to Long Debugging Sessions">​</a></h3>
<p>When debugging complex issues, conversations can become lengthy. Context compaction allows the agent to remember key debugging steps while summarizing earlier diagnostics.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="multi-stage-project-development">Multi-Stage Project Development<a href="#multi-stage-project-development" class="hash-link" aria-label="Direct link to Multi-Stage Project Development" title="Direct link to Multi-Stage Project Development">​</a></h3>
<p>For projects developed over multiple sessions, context compaction enables the agent to maintain awareness of project requirements and previous decisions while focusing on current tasks.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="interactive-learning-and-tutorials">Interactive Learning and Tutorials<a href="#interactive-learning-and-tutorials" class="hash-link" aria-label="Direct link to Interactive Learning and Tutorials" title="Direct link to Interactive Learning and Tutorials">​</a></h3>
<p>When using Forge for learning or following tutorials, compaction helps maintain the thread of the lesson while summarizing earlier explanations.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="performance-considerations">Performance Considerations<a href="#performance-considerations" class="hash-link" aria-label="Direct link to Performance Considerations" title="Direct link to Performance Considerations">​</a></h2>
<p>Context compaction runs asynchronously to minimize impact on response times. However, consider these performance factors:</p>
<ul>
<li><strong>Summarization Latency</strong>: More powerful summarization models may take longer</li>
<li><strong>Summary Quality vs. Speed</strong>: Balance between fast models and high-quality summaries</li>
<li><strong>Token Thresholds</strong>: Lower thresholds trigger more frequent compaction</li>
<li><strong>Retention Window Size</strong>: Larger windows preserve more context but reduce compaction efficiency</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="issue-context-seems-lost-after-compaction">Issue: Context Seems Lost After Compaction<a href="#issue-context-seems-lost-after-compaction" class="hash-link" aria-label="Direct link to Issue: Context Seems Lost After Compaction" title="Direct link to Issue: Context Seems Lost After Compaction">​</a></h3>
<ul>
<li>Increase <code>max_tokens</code> to allow for more detailed summaries</li>
<li>Use a more capable summarization model</li>
<li>Increase the retention window to preserve more recent messages</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="issue-slow-responses-after-threshold-is-reached">Issue: Slow Responses After Threshold is Reached<a href="#issue-slow-responses-after-threshold-is-reached" class="hash-link" aria-label="Direct link to Issue: Slow Responses After Threshold is Reached" title="Direct link to Issue: Slow Responses After Threshold is Reached">​</a></h3>
<ul>
<li>Choose a faster summarization model</li>
<li>Reduce the token threshold to trigger earlier compaction</li>
<li>Consider lowering <code>max_tokens</code> if full context isn&#x27;t critical</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="related-features">Related Features<a href="#related-features" class="hash-link" aria-label="Direct link to Related Features" title="Direct link to Related Features">​</a></h2>
<ul>
<li><a href="/docs/agent-configuration/">Agent Configuration</a> - Learn about other agent configuration options</li>
<li><a href="/docs/operation-modes/">Operation Modes</a> - Understand how context works in different operation modes</li>
<li><a href="/docs/tools-reference/">Tools Reference</a> - Explore the tools agents use to interact with your system</li>
</ul>
<hr>
<p>By effectively using context compaction, you can maintain longer, more productive AI conversations while optimizing for performance and cost efficiency.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/antinomyhq/antinomyhq.github.io/tree/main/docs/context-compaction.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-04-01T10:16:06.000Z" itemprop="dateModified">Apr 1, 2025</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="!no-underline flex gap-3 items-center" href="/docs/agent-configuration/"><div class="w-10 h-10 p-2 bg-tailCall-yellow flex justify-center items-center rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg></div><div class="hidden md:block"><div class="text-tailCall-dark-100 text-[12px] font-medium">Previous</div><div class="pagination-nav__label text-black text-content-small font-medium">Agent Configuration</div></div></a><a class="!no-underline flex gap-3 items-center" href="/docs/custom-commands/"><div class="hidden md:block"><div class="text-tailCall-dark-100 text-[12px] font-medium">Next</div><div class="pagination-nav__label text-black text-content-small font-medium">Custom Commands</div></div><div class="w-10 h-10 p-2 bg-tailCall-yellow flex justify-center items-center rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg></div></a></nav><div class="min-h-[450px]"><hr><br></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-context-compaction" class="table-of-contents__link toc-highlight">What is Context Compaction?</a></li><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How It Works</a></li><li><a href="#configuration-options" class="table-of-contents__link toc-highlight">Configuration Options</a><ul><li><a href="#configuration-parameters" class="table-of-contents__link toc-highlight">Configuration Parameters</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#selecting-appropriate-thresholds" class="table-of-contents__link toc-highlight">Selecting Appropriate Thresholds</a></li><li><a href="#choosing-summarization-models" class="table-of-contents__link toc-highlight">Choosing Summarization Models</a></li><li><a href="#retention-window-considerations" class="table-of-contents__link toc-highlight">Retention Window Considerations</a></li></ul></li><li><a href="#example-use-cases" class="table-of-contents__link toc-highlight">Example Use Cases</a><ul><li><a href="#long-debugging-sessions" class="table-of-contents__link toc-highlight">Long Debugging Sessions</a></li><li><a href="#multi-stage-project-development" class="table-of-contents__link toc-highlight">Multi-Stage Project Development</a></li><li><a href="#interactive-learning-and-tutorials" class="table-of-contents__link toc-highlight">Interactive Learning and Tutorials</a></li></ul></li><li><a href="#performance-considerations" class="table-of-contents__link toc-highlight">Performance Considerations</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#issue-context-seems-lost-after-compaction" class="table-of-contents__link toc-highlight">Issue: Context Seems Lost After Compaction</a></li><li><a href="#issue-slow-responses-after-threshold-is-reached" class="table-of-contents__link toc-highlight">Issue: Slow Responses After Threshold is Reached</a></li></ul></li><li><a href="#related-features" class="table-of-contents__link toc-highlight">Related Features</a></li></ul></div></div></div></div></main></div></div></div><footer class="flex flex-col relative w-full relative px-4 py-8 lg:px-40 lg:pt-20 lg:pb-0 bg-tailCall-dark-700 grid-dark gap-4 lg:gap-8"><div class="grid grid-cols-2 gap-8 lg:flex lg:gap-32 xl:gap-64 w-full z-10"><span class="text-2xl font-semibold text-white col-span-2 h-10 flex items-center">Forge</span><div class="flex flex-col gap-4 lg:gap-6"><span class="text-content-small font-bold lg:text-title-small text-white leading-[20px] lg:leading-[26px]">Developers</span><a class="text-content-small lg:text-content-medium text-tailCall-light-500 hover:text-tailCall-light-300 hover:no-underline leading-[20px] lg:leading-[26px]" href="/docs/">Docs</a></div><div class="flex flex-col gap-4 lg:gap-6"><span class="text-content-small font-bold lg:text-title-small text-white leading-[20px] lg:leading-[26px]">Company</span><a class="text-content-small lg:text-content-medium text-tailCall-light-500 hover:text-tailCall-light-300 hover:no-underline leading-[20px] lg:leading-[26px]" href="/privacy/">Privacy Policy</a></div></div><div class="flex flex-col lg:flex-row items-center lg:justify-between w-[100%] lg:w-full z-10 py-2 lg:py-6 gap-2 lg:gap-0"><p class="text-content-mini lg:text-content-tiny text-tailCall-light-700 font-space-mono font-normal cursor-pointer mb-0">Cookie Settings</p><p class="text-content-mini lg:text-content-tiny text-tailCall-light-700 font-space-mono font-normal mb-0">Copyright © <!-- -->2025<!-- --> Tailcall, Inc.</p><div class="space-x-SPACE_04"><a href="https://github.com/antinomyhq/forge" target="_blank" rel="noopener noreferrer" class="cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="h-6 w-6"><g clip-path="url(#a)"><path fill="#B6B6B7" fill-rule="evenodd" d="M11.967 1C5.903 1 1 6.042 1 12.279c0 4.986 3.141 9.206 7.5 10.7.544.112.743-.243.743-.542 0-.261-.017-1.157-.017-2.091C6.175 21.018 5.539 19 5.539 19c-.49-1.307-1.216-1.643-1.216-1.643-.999-.69.072-.69.072-.69 1.108.074 1.69 1.157 1.69 1.157.98 1.718 2.56 1.232 3.195.934.09-.729.381-1.233.69-1.513-2.433-.261-4.993-1.232-4.993-5.565 0-1.232.435-2.24 1.125-3.025-.109-.28-.49-1.438.11-2.988 0 0 .925-.298 3.013 1.158a10.3 10.3 0 0 1 2.742-.373c.926 0 1.87.13 2.742.373 2.088-1.456 3.014-1.158 3.014-1.158.6 1.55.218 2.708.109 2.988.708.784 1.126 1.793 1.126 3.025 0 4.333-2.56 5.285-5.012 5.565.4.355.745 1.027.745 2.092 0 1.512-.018 2.726-.018 3.1 0 .298.2.653.744.54 4.358-1.493 7.5-5.713 7.5-10.7C22.933 6.043 18.013 1 11.966 1" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M1 1h22v22H1z"></path></clipPath></defs></svg></a><a href="https://discord.gg/kRZBPpkgwq" target="_blank" rel="noopener noreferrer" class="cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="h-6 w-6"><mask id="a" width="20" height="16" x="2" y="4" maskUnits="userSpaceOnUse" style="mask-type:luminance"><path fill="#fff" d="M22 4H2v16h20z"></path></mask><g mask="url(#a)"><path fill="#B6B6B7" d="M18.93 5.425a16.1 16.1 0 0 0-4.07-1.304.06.06 0 0 0-.066.032c-.175.323-.37.744-.506 1.075a14.8 14.8 0 0 0-4.573 0A11 11 0 0 0 9.2 4.153a.06.06 0 0 0-.065-.032 16 16 0 0 0-4.07 1.304.06.06 0 0 0-.028.024c-2.593 4-3.303 7.902-2.954 11.756a.07.07 0 0 0 .026.048 16.4 16.4 0 0 0 4.994 2.608.06.06 0 0 0 .07-.024 12.3 12.3 0 0 0 1.022-1.716.066.066 0 0 0-.035-.091 11 11 0 0 1-1.56-.768.068.068 0 0 1-.007-.11q.159-.122.31-.251a.06.06 0 0 1 .065-.01c3.273 1.544 6.817 1.544 10.051 0a.06.06 0 0 1 .066.01c.1.084.205.17.31.25a.068.068 0 0 1-.005.11q-.747.45-1.561.768a.067.067 0 0 0-.034.091c.3.601.643 1.173 1.02 1.716a.06.06 0 0 0 .07.025 16.3 16.3 0 0 0 5.003-2.608.07.07 0 0 0 .026-.047c.417-4.455-.699-8.325-2.957-11.756a.05.05 0 0 0-.026-.025M8.684 14.86c-.985 0-1.797-.935-1.797-2.082 0-1.148.796-2.082 1.797-2.082 1.01 0 1.814.943 1.798 2.082 0 1.147-.796 2.082-1.798 2.082m6.646 0c-.985 0-1.797-.935-1.797-2.082 0-1.148.796-2.082 1.797-2.082 1.009 0 1.813.943 1.797 2.082 0 1.147-.788 2.082-1.797 2.082"></path></g></svg></a></div></div></footer></div>
</body>
</html>